# üê≥ Docker Setup –¥–ª—è AI Chatter

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å AI Chatter –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
cp env.example .env
```

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`:
```env
# Telegram
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
ADMIN_USER_ID=your_telegram_user_id

# LLM Provider (–≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω)
OPENAI_API_KEY=sk-your_openai_key     # –¥–ª—è OpenAI/OpenRouter
# –∏–ª–∏
YANDEX_OAUTH_TOKEN=your_yandex_token  # –¥–ª—è YandexGPT

# Notion (–¥–ª—è –æ—Ç—á—ë—Ç–æ–≤ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤)
NOTION_TOKEN=secret_your_notion_token
NOTION_PARENT_PAGE_ID=your-page-id
```

### 2. –ó–∞–ø—É—Å–∫

```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f ai-chatter-bot

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

Docker setup –≤–∫–ª—é—á–∞–µ—Ç:
- **AI Chatter Bot** - –æ—Å–Ω–æ–≤–Ω–æ–π Telegram –±–æ—Ç
- **Custom MCP Server** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Notion MCP —Å–µ—Ä–≤–µ—Ä
- **Volumes** - –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ –ª–æ–≥–æ–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Docker Container        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ AI Chatter  ‚îÇ ‚îÇ Notion MCP  ‚îÇ‚îÇ 
‚îÇ  ‚îÇ    Bot      ‚îÇ‚óÑ‚îÄ‚î§   Server    ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                 ‚îÇ
‚îÇ  üìÅ /app/data   üìÅ /app/logs    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ              ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ ./data   ‚îÇ   ‚îÇ ./logs   ‚îÇ
    ‚îÇ (host)   ‚îÇ   ‚îÇ (host)   ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
- `TELEGRAM_BOT_TOKEN` - —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
- `ADMIN_USER_ID` - ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞  
- `OPENAI_API_KEY` –∏–ª–∏ `YANDEX_OAUTH_TOKEN` - API –∫–ª—é—á LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

### Notion (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ)
- `NOTION_TOKEN` - Integration token –¥–ª—è Notion
- `NOTION_PARENT_PAGE_ID` - ID —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ
- `LLM_PROVIDER` - `openai` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –∏–ª–∏ `yandex`
- `OPENAI_MODEL` - –º–æ–¥–µ–ª—å OpenAI (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `gpt-3.5-turbo`)
- `MESSAGE_PARSE_MODE` - `HTML` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), `Markdown`, –∏–ª–∏ `MarkdownV2`

## Volumes

- `./data:/app/data` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (allowlist, pending, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
- `./logs:/app/logs` - –ª–æ–≥–∏ –≤ JSONL —Ñ–æ—Ä–º–∞—Ç–µ

## –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üìä –°–∏—Å—Ç–µ–º–∞ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞)

```bash
# –†—É—á–Ω–æ–π –æ—Ç—á—ë—Ç –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—É—Ç–∫–∏
/report

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç—á—ë—Ç—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 21:00 UTC
# (–∞–¥–º–∏–Ω –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
```

### ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ Notion —Ñ—É–Ω–∫—Ü–∏–∏

LLM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–æ–∂–µ—Ç:
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∏–∞–ª–æ–≥–∏ –≤ Notion (`save_dialog_to_notion`)
- –ò—Å–∫–∞—Ç—å –ø—Ä–æ—à–ª—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã (`search_notion`)  
- –°–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (`create_notion_page`)
- –°–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç—á—ë—Ç—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü

### üîó –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

LLM –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —Å–ª–æ–∂–Ω—ã–µ workflows:
1. –ü–æ–∏—Å–∫–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É "Reports"
2. –°–æ–∑–¥–∞—Ç—å –µ—ë –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞  
3. –°–æ–∑–¥–∞—Ç—å –æ—Ç—á—ë—Ç –∫–∞–∫ –ø–æ–¥—Å—Ç—Ä–∞–Ω–∏—Ü—É
4. –£–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å—Å—ã–ª–∫–æ–π

## –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
# –õ–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose logs -f

# –¢–æ–ª—å–∫–æ –ª–æ–≥–∏ –±–æ—Ç–∞
docker-compose logs -f ai-chatter-bot

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
docker-compose logs --tail=100 ai-chatter-bot
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ—Å—É—Ä—Å–∞—Ö
docker stats
```

### –í—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
```bash
# Bash –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker-compose exec ai-chatter-bot sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
docker-compose exec ai-chatter-bot ps aux
```

### Rebuild
```bash
# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
docker-compose build --no-cache
docker-compose up -d
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Docker —Å–±–æ—Ä–∫–∏

```bash
# –¢–µ—Å—Ç —Å–±–æ—Ä–∫–∏ (–±–µ–∑ –∑–∞–ø—É—Å–∫–∞)
./scripts/docker-build-test.sh
```

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker-compose logs ai-chatter-bot

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker-compose config
```

### –ü—Ä–æ–±–ª–µ–º–∞: –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ Notion
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `NOTION_TOKEN` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫ –Ω—É–∂–Ω—ã–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `NOTION_PARENT_PAGE_ID` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

### –ü—Ä–æ–±–ª–µ–º–∞: –æ—Ç—á—ë—Ç—ã –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–æ–º (`ADMIN_USER_ID`)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –µ—Å—Ç—å –ª–æ–≥–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤ `./logs/log.jsonl`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Notion –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞

### –ü—Ä–æ–±–ª–µ–º–∞: –±–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞
```bash
# –û—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –æ–±—Ä–∞–∑–æ–≤
docker system prune -a

# –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–º–µ—Ä–∞ —Å–ª–æ—ë–≤
docker history ai-chatter-ai-chatter-bot
```

## Production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### Systemd —Å–µ—Ä–≤–∏—Å
```ini
# /etc/systemd/system/ai-chatter.service
[Unit]
Description=AI Chatter Bot Docker
Requires=docker.service
After=docker.service

[Service]
Type=oneshot
RemainAfterExit=yes
WorkingDirectory=/opt/ai-chatter
ExecStart=/usr/local/bin/docker-compose up -d
ExecStop=/usr/local/bin/docker-compose down
TimeoutStartSec=0

[Install]
WantedBy=multi-user.target
```

### –õ–æ–≥—Ä–æ—Ç–∞—Ü–∏—è
```bash
# /etc/logrotate.d/ai-chatter
/opt/ai-chatter/logs/*.jsonl {
    daily
    missingok
    rotate 30
    compress
    notifempty
    sharedscripts
    postrotate
        docker-compose -f /opt/ai-chatter/docker-compose.yml restart ai-chatter-bot
    endscript
}
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
# Health check
curl -f http://localhost:8080/health || docker-compose restart ai-chatter-bot

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats --no-stream ai-chatter-bot
```

## Benefits

- ‚úÖ **–ü—Ä–æ—Å—Ç–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ** - –æ–¥–∏–Ω docker-compose –∫–æ–º–∞–Ω–¥–∞
- ‚úÖ **–ò–∑–æ–ª—è—Ü–∏—è** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—Ä–µ–¥–∞
- ‚úÖ **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** - MCP —Å–µ—Ä–≤–µ—Ä –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ **Production ready** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- ‚úÖ **–õ–µ–≥–∫–∏–π upgrade** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ rebuild –æ–±—Ä–∞–∑–∞
